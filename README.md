# QSnake
snake game with Qt

**Qsnake is a snake game with basic functions and simple AI mode. Qt framework is used to realize the game.**

# Qsnake设计文档


## 整体设计思路

本游戏实现了所有要求的功能，具体设计如下：

贪吃蛇游戏可以分为两大部分：

* 一个二维数组。该数组中不同的值对应不同的**<u>元素</u>**，即蛇、砖块、食物等等。每一个元素都有一个固定的**坐标**。
* QT的UI框架。作用是将二维数组画在屏幕上，将经过映射的坐标，**渲染**成图像。并且根据不同时间间隔调用函数，更新二维数组。

通过用户的操作，不断可以更新二维数组，并实时渲染在屏幕上。同时，也可以储存和读取这个二维数组，达到读档和存档的功能。



主要类有以下一些：

* node结构体。node记录了坐标点，提供了对坐标点的操作
* Atlas_int类。生成二维数组，里面储存了各个枚举变量，代表了各个元素。
* Snake类。储存蛇的相关信息，对蛇进行相关操作。
* Canvas类。储存了除了蛇外的元素，并且提供对元素操作的方法。
* MainWindow类。游戏主界面，画出游戏界面，并且接受用户的操作信息。
* Edit类。编辑图形界面，可以保存游戏、编辑地图等等。
* Dialog类。开启界面，可供用户选择游戏模式。



## 规则的详细说明

* 蛇初始状态的生成：随机挑选生成位置和生成的方向，规定在中央矩形区域中生成，生成的初始长度为5。
* 地图元素的生成：随机生成，但是规定在某一元素上下左右四个位置不允许生成新元素，规定在地图最外圈不允许生成新元素。
* 蛇的速度：蛇的速度有一个范围，**增减超过极值时，速度会被设定为极值**。
* 速度的显示：0表示初始速度，负数表示相对减速，正数表示相对加速。
* 蛇的死亡：撞击砖块会减少一条命，命为0时游戏结束。**但是蛇可以穿越边界，它会从屏幕的另一边穿出来。**
* 地图编辑：通过点击需要移动的地图元素，取出它，在需要的位置再次点击，放置它。但是一些点击行为被设为不合法，不会响应。比如，点击蛇的身体，或者在蛇移动的时候点击元素。
* AI模式：AI模式在蛇的长度超过60左右会有不稳定的行为，蛇可能会死亡。AI模式对于双人模式的支持尚不完善。



## 一些变量的说明

* atlas_array 这是一个二维数组，储存了所有**元素**

* ```c++
  enum DIREC{UP,DOWN,LEFT,RIGHT}；//定义四个基本方向
  ```

* ```c++
  enum CANVAS_ELEM{NONE,SNAKE,BRICK,ORDIN_FOOD,LIFE_FOOD,SUP_FOOD,SDOWN_FOOD,STRENGTH_FOOD};//定义元素
  ```

## 类之间的关系




Dialog是游戏初始界面，根据用户的选择创建不同的游戏模式，或是打开历史游戏存档。

MainWindow是游戏界面，用户可以进行游戏。

Edit是暂停时的编辑界面，用户可以选择AI模式、保存游戏、继续游戏、直接返回、编辑地图。

利用Qt提供了signal-slot机制，三个类之间实现传输信号，并调用相关函数。




MainWindow生成某一次游戏。

User根据用户选择生成玩家数量，根据用户选择模式，决定是AI自动控制蛇还是玩家控制。

Canvas记录所有元素的信息，它是所有玩家共有的。

## 其他考虑

* 用户异常行为
  * 多次点击按钮
  * 不合法键盘输入（错误按键、持续按键达到加速目的）
* 程序异常行为
  * 单击按键后，时间间隔过短，无法显示游戏界面
  * 信号同时发生，槽函数堵塞
